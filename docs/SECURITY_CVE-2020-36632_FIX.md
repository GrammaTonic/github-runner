# Security Fix: CVE-2020-36632 - Prototype Pollution in flat package

## Issue

- **CVE**: CVE-2020-36632
- **Severity**: CRITICAL
- **Component**: `flat` package (dependency of Cypress)
- **Vulnerable Version**: 4.1.1 (bundled with Cypress 15.1.0)
- **Fixed Version**: 5.0.1+
- **Description**: Prototype pollution vulnerability in the `unflatten` function

## Root Cause

The Chrome runner Docker image was installing the latest Cypress version globally, which included a vulnerable version of the `flat` package (4.1.1). This created a security vulnerability in the Cypress cache.

## Solution Applied

1. **Version Pinning**: Updated `Dockerfile.chrome` to pin Cypress to version `14.5.4` (latest secure version)
2. **Framework Updates**: Updated Playwright to latest version `1.55.0`
3. **Security Comment**: Added comments explaining the security fix
4. **Image Version Bump**: Updated Docker image version from `1.0.1` to `1.0.3`

## Changes Made

```dockerfile
# Before (vulnerable)
RUN npm install -g \
    playwright \
    cypress \
    @playwright/test \
    && npx playwright install chromium

# After (secure + latest)
# Install common testing frameworks with version pinning for security
# Cypress 14.5.4 - Latest stable version without CVE-2020-36632 (flat package vulnerability)
# Playwright 1.55.0 - Latest stable version (published 16 days ago)
RUN npm install -g \
    playwright@1.55.0 \
    cypress@14.5.4 \
    @playwright/test@1.55.0 \
    && npx playwright install chromium
```

## Verification

- Cypress 14.5.4 is the latest stable version without the vulnerable `flat` package
- Playwright 1.55.0 is the current latest version with all security fixes
- Version pinning prevents automatic updates to potentially vulnerable versions
- Docker image version updated to 1.0.3 to reflect both security and feature improvements

## Impact

- ✅ Resolves CVE-2020-36632 prototype pollution vulnerability
- ✅ Improves build reproducibility through version pinning
- ✅ Maintains functionality while enhancing security

## Next Steps

1. Rebuild Docker images with the updated Dockerfile
2. Deploy updated images to production
3. Verify security scan passes with the new images
4. Monitor for any compatibility issues with the pinned versions

## Related Files

- `docker/Dockerfile.chrome` - Updated with security fixes
- This security documentation
